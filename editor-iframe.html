<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Editor de Pedido (iframe)</title>
<style>
  :root{--bg:#fff;--muted:#6b7280;--accent:#0b5fff;--danger:#b91c1c}
  html,body{height:100%;margin:0;font-family:Inter,Arial,Helvetica,sans-serif;background:transparent}
  /* Modal container (centra verticalmente) */
  .wrap{height:100%;display:flex;align-items:center;justify-content:center;padding:24px}
  .modal{
    width:720px; max-width:calc(100% - 40px);
    background:var(--bg); border-radius:12px; box-shadow:0 10px 30px rgba(2,6,23,0.2);
    padding:18px; border:1px solid rgba(0,0,0,0.05)
  }
  .modal h2{margin:0 0 10px;font-size:20px}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
  input[type="text"], input[type="tel"], select, textarea{
    width:100%; padding:10px 12px; border-radius:8px; border:1px solid #e6e9ef;
    font-size:14px; outline:none; box-shadow:none
  }
  textarea{min-height:90px; resize:vertical}
  .full{grid-column:1/-1}
  .row{display:flex;gap:8px;justify-content:flex-end;margin-top:12px}
  .btn{padding:10px 14px;border-radius:8px;border:1px solid transparent;font-weight:600;cursor:pointer}
  .btn.ghost{background:#fff;border-color:#e6e6e6;color:#374151}
  .btn.primary{background:var(--accent);color:#fff}
  .btn.danger{background:#fff;color:var(--danger);border:1px solid rgba(185,28,28,0.11)}
  .help{font-size:12px;color:var(--muted);margin-top:8px}
  /* small responsive */
  @media(max-width:560px){ .grid{grid-template-columns:1fr} .row{flex-direction:column-reverse;align-items:stretch} }
</style>
</head>
<body>

<div class="wrap" role="dialog" aria-modal="true" aria-label="Editar pedido">
  <div class="modal">
    <h2>Editar pedido <span id="orderId" style="color:#374151;font-weight:700">#1234</span></h2>

    <form id="editForm" onsubmit="return false;">
      <div class="grid">
        <!-- Status -->
        <div>
          <label for="status">Status</label>
          <select id="status" name="status" aria-label="Status do pedido">
            <option value="Pendente">Pendente</option>
            <option value="Pago">Pago</option>
            <option value="Enviado">Enviado</option>
            <option value="Finalizado">Finalizado</option>
            <option value="Cancelado">Cancelado</option>
          </select>
        </div>

        <!-- Forma de pagamento -->
        <div>
          <label for="payment">Forma de pagamento</label>
          <select id="payment" name="payment">
            <option value="Pix">Pix</option>
            <option value="Cartão">Cartão</option>
            <option value="Boleto">Boleto</option>
            <option value="Dinheiro">Dinheiro</option>
          </select>
        </div>

        <!-- Nome do recebedor -->
        <div>
          <label for="receiver">Nome do recebedor</label>
          <input id="receiver" name="receiver" type="text" />
        </div>

        <!-- Telefone -->
        <div>
          <label for="phone">Telefone</label>
          <input id="phone" name="phone" type="tel" />
        </div>

        <!-- Rua, número -->
        <div class="full">
          <label for="street">Endereço (Rua, Nº, Complemento)</label>
          <input id="street" name="street" type="text" />
        </div>

        <!-- Cidade / CEP -->
        <div>
          <label for="city">Cidade / Estado</label>
          <input id="city" name="city" type="text" />
        </div>

        <div>
          <label for="zip">CEP</label>
          <input id="zip" name="zip" type="text" />
        </div>

        <!-- Observação interna -->
        <div class="full">
          <label for="note">Observação interna</label>
          <textarea id="note" name="note" placeholder="Notas visíveis apenas para administradores"></textarea>
        </div>
      </div>

      <div class="help">Alterações feitas aqui não são aplicadas automaticamente ao sistema até você clicar em "Salvar".</div>

      <div class="row" style="margin-top:16px">
        <button type="button" class="btn ghost" id="btnCancel">Cancelar</button>
        <button type="button" class="btn danger" id="btnApply">Aplicar (salvar localmente)</button>
        <button type="button" class="btn primary" id="btnSave">Salvar</button>
      </div>
    </form>
  </div>
</div>

<script>
/*
  Este iframe comunica com o parent via postMessage.
  Mensagens emitidas:
    - { type: 'editor:ready' }  -> quando iframe carregou (opcional)
    - { type: 'editor:cancel' } -> usuário cancelou
    - { type: 'editor:apply', payload: {...} } -> aplicar alterações localmente (ex: preview)
    - { type: 'editor:save', payload: {...} } -> salvar (parent deve chamar API)
*/

/* Mock: preenche o form se o parent enviar dados */
window.addEventListener('message', e => {
  if(!e.data) return;
  const msg = e.data;
  if(msg.type === 'editor:load') fillForm(msg.payload);
});

/* helpers */
const el = id => document.getElementById(id);
function getFormData(){
  return {
    id: el('orderId').textContent.replace('#','').trim(),
    status: el('status').value,
    payment: el('payment').value,
    receiver: el('receiver').value,
    phone: el('phone').value,
    street: el('street').value,
    city: el('city').value,
    zip: el('zip').value,
    note: el('note').value
  };
}
function fillForm(order){
  if(!order) return;
  el('orderId').textContent = '#' + (order.id || order.orderId || '');
  el('status').value = order.status || 'Pendente';
  el('payment').value = order.paymentMethod || 'Pix';
  el('receiver').value = order.delivery?.name || order.client?.name || '';
  el('phone').value = order.delivery?.phone || order.client?.phone || '';
  el('street').value = order.delivery?.street || '';
  el('city').value = order.delivery?.city || '';
  el('zip').value = order.delivery?.zip || '';
  el('note').value = order.adminNote || '';
}

/* dispatchers */
function post(type, payload){ parent.postMessage({ type, payload }, '*'); }

el('btnCancel').addEventListener('click', () => post('editor:cancel', null));
el('btnApply').addEventListener('click', () => {
  const payload = getFormData();
  post('editor:apply', payload);
});
el('btnSave').addEventListener('click', () => {
  const payload = getFormData();
  // Mensagem para parent salvar (parent pode chamar API com payload)
  post('editor:save', payload);
});

/* avisa que o iframe está pronto */
post('editor:ready', null);
</script>
</body>
</html>
